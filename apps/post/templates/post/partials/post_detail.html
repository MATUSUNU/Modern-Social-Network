{% load post_tags %}

<div class="card mb-3">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h5 class="mb-1">{{object.user}}</h5>
        <small class="text-muted">{{object.created_at|date:"M. d, Y"}}</small>
      </div>
      {% if post.user == request.user %}
        <div>
          <a href="{% url 'post:post_update' pk=post.id %}" class="btn btn-sm btn-outline-primary me-2" title="Edit">
            <i class="fas fa-edit"></i>
          </a>
          <a href="{% url 'post:post_delete' pk=post.id %}" class="btn btn-sm btn-outline-danger" title="Delete">
            <i class="fas fa-trash-alt"></i>
          </a>
        </div>
      {% endif %}
    </div>

    <p class="mt-3">{{ object.content }}</p>

    {% if object.image %}
      <img src="{{ object.image.url }}"
        class="img-fluid rounded"
        alt="Post image">
    {% endif %}

    <div class="d-flex justify-content-around mt-3">
      {% if user.is_authenticated %}

        <form class="d-inline"
              hx-post="{% url 'post:like_post' pk=object.id %}"
              hx-target="this"
              hx-swap="outerHTML">
          {% csrf_token %}
          <div class="like-section">
            <button type="submit"
              class="btn btn-sm {% if post|user_liked_post:request.user %}btn-success{% else %}btn-outline-success{% endif %}">
              ğŸ‘ {{ post.num_likes }} Like{{ post.num_likes|pluralize }}
            </button>
          </div>
        </form>

      {% else %}
        <form action="{% url 'post:like_post' pk=object.id %}" method="post" class="d-inline">
          {% csrf_token %}
          <button type="submit"
            class="
              btn btn-sm btn-outline-success">
            ğŸ‘ {{ object.num_likes }} Like{{ object.num_likes|pluralize }}
          </button>
        </form>
      {% endif %}
    </div>

  </div>

  <div class="card-footer bg-white border-top text-start">

    <div class="d-flex align-items-center mb-3">
      <h6 class="fw-bold mb-0">
        <i class="fas fa-comments me-2 text-secondary"></i>Comments
        <span class="badge bg-secondary ms-2" id="comment-count">{{ comments.count }}</span>
      </h6>
    </div>

    <form hx-post="{% url 'post:comment_create' pk=post.id %}"
          hx-target="#comments-list"
          hx-swap="beforeend"
          hx-on::after-request="this.reset()"
          class="d-flex mb-4">
      {% csrf_token %}
      <input type="text"
            name="content"
            class="form-control form-control-sm me-2"
            placeholder="Write a comment..."
            required>
      <button type="submit" class="btn btn-sm btn-success">
        Post
      </button>
    </form>

    <div id="comments-list">
      {% for comment in comments %}
        {% include 'post/partials/comment_item.html' %}
      {% endfor %}
    </div>

  </div>
</div>
