{% load post_tags %}

{% for comment in comments %}
  <div class="border rounded p-2 mb-2" id="comment-{{ comment.id }}">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <strong>{{ comment.user }}</strong>
        <small class="text-muted ms-2">{{ comment.created_at|date:"M. d, Y" }}</small>
      </div>

      {% if comment.user == request.user %}
        <div class="btn-group btn-group-sm" role="group">
          <!-- <form action="#" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-primary" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
          </form> -->

          <!-- <form action="{% url 'post:comment_delete' pk=comment.id %}" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
              <i class="fas fa-trash-alt"></i>
            </button>
          </form> -->

          <form class="d-inline"
                hx-post="{% url 'post:comment_delete' pk=comment.id %}"
                hx-target="#comment-{{comment.id}}"
                hx-swap="outerHTML"
          >
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
              <i class="fas fa-trash-alt"></i>
            </button>
          </form>
        </div>
      {% endif %}
    </div>
    <p class="mb-0 mt-1">{{ comment.content }}</p>

    {% if page_obj.has_next and forloop.last %}

      <div class="text-center">
        <span
          hx-get="{% url 'post:post_comment' pk=post.id %}?page={{ page_obj.next_page_number }}"
          hx-target="#comments-list"
          hx-select=".border"
          hx-swap="beforeend"
          hx-trigger="revealed"
          hx-indicator="#spinner"
        >
        </span>
      </div>

    {% endif %}

  </div>
{% endfor %}
